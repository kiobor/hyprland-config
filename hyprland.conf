# ╔═══════════════════════════════════════════════════════════╗
# ║           HYPRLAND CONFIGURATION FILE                     ║
# ║           IdeaPad Pro 5 14AHP9 - AMD Ryzen 7 8845HS      ║
# ║           2880x1800 @ 120Hz - Radeon 780M iGPU           ║
# ╚═══════════════════════════════════════════════════════════╝

# ═══════════════════════════════════════════════════════════
# MONITOR CONFIGURATION - 2880x1800 @ 120Hz
# ═══════════════════════════════════════════════════════════
monitor=,2880x1800@120,0x0,1.6
# Scaling 1.6x per display 14" ad alta risoluzione
# Per usare 120Hz: assicurati che il refresh rate sia supportato

# ═══════════════════════════════════════════════════════════
# AUTOSTART APPLICATIONS
# ═══════════════════════════════════════════════════════════
exec-once = waybar
exec-once = hyprpaper
exec-once = dunst
exec-once = /usr/lib/polkit-kde-authentication-agent-1
exec-once = dbus-update-activation-environment --systemd WAYLAND_DISPLAY XDG_CURRENT_DESKTOP
exec-once = systemctl --user import-environment WAYLAND_DISPLAY XDG_CURRENT_DESKTOP
exec-once = wl-paste --type text --watch cliphist store
exec-once = wl-paste --type image --watch cliphist store
exec-once = kdeconnect-indicator

# Battery optimization
exec-once = powerprofilesctl set balanced

# ═══════════════════════════════════════════════════════════
# ENVIRONMENT VARIABLES
# ═══════════════════════════════════════════════════════════
env = XCURSOR_SIZE,24
env = QT_QPA_PLATFORMTHEME,kde
env = QT_QPA_PLATFORM,wayland
env = QT_STYLE_OVERRIDE,Breeze
env = GDK_BACKEND,wayland,x11
env = SDL_VIDEODRIVER,wayland
env = CLUTTER_BACKEND,wayland
env = XDG_CURRENT_DESKTOP,Hyprland
env = XDG_SESSION_TYPE,wayland
env = XDG_SESSION_DESKTOP,Hyprland
env = QT_AUTO_SCREEN_SCALE_FACTOR,1
env = QT_WAYLAND_DISABLE_WINDOWDECORATION,1

# AMD Radeon ottimizzazioni
env = RADV_PERFTEST,gpl
env = AMD_VULKAN_ICD,RADV
env = LIBVA_DRIVER_NAME,radeonsi
env = VDPAU_DRIVER,radeonsi

# ═══════════════════════════════════════════════════════════
# INPUT CONFIGURATION
# ═══════════════════════════════════════════════════════════
input {
    kb_layout = it
    kb_variant =
    kb_model =
    kb_options =
    kb_rules =

    follow_mouse = 1
    mouse_refocus = true
    float_switch_override_focus = 1

    touchpad {
        natural_scroll = true
        tap-to-click = true
        drag_lock = false
        disable_while_typing = true
        scroll_factor = 0.3
        clickfinger_behavior = true
        middle_button_emulation = true
    }

    sensitivity = 0
    accel_profile = adaptive
}

# ═══════════════════════════════════════════════════════════
# GENERAL SETTINGS
# ═══════════════════════════════════════════════════════════
general {
    gaps_in = 4
    gaps_out = 8
    border_size = 2
    
    # Breeze colors (KDE Plasma tema)
    col.active_border = rgba(3daee9ff) rgba(61b1f5ff) 45deg
    col.inactive_border = rgba(4d4d4daa)

    layout = dwindle
    allow_tearing = false
    resize_on_border = true
    hover_icon_on_border = true
}

# ═══════════════════════════════════════════════════════════
# DECORATION - Ottimizzato per AMD iGPU
# ═══════════════════════════════════════════════════════════

# ═══════════════════════════════════════════════════════════
# ANIMATIONS - Ottimizzate per 120Hz
# ═══════════════════════════════════════════════════════════
animations {
    enabled = true
    
    bezier = wind, 0.05, 0.9, 0.1, 1.05
    bezier = winIn, 0.1, 1.1, 0.1, 1.1
    bezier = winOut, 0.3, -0.3, 0, 1
    bezier = liner, 1, 1, 1, 1
    bezier = smooth, 0.23, 1, 0.32, 1
    bezier = fluid, 0.4, 0.0, 0.2, 1
    
    animation = windows, 1, 5, wind, slide
    animation = windowsIn, 1, 5, winIn, slide
    animation = windowsOut, 1, 4, winOut, slide
    animation = windowsMove, 1, 4, wind, slide
    animation = border, 1, 1, liner
    animation = borderangle, 1, 100, liner, loop
    animation = fade, 1, 8, smooth
    animation = workspaces, 1, 4, fluid, slide
    animation = specialWorkspace, 1, 4, fluid, slidevert
}

# ═══════════════════════════════════════════════════════════
# LAYOUTS
# ═══════════════════════════════════════════════════════════
dwindle {
    pseudotile = true
    preserve_split = true
    force_split = 2
    smart_split = false
    smart_resizing = true
}

master {
    new_status = master
    new_on_top = false
    mfact = 0.55
    orientation = left
    smart_resizing = true
}

# ═══════════════════════════════════════════════════════════
# GESTURES - Ottimizzati per touchpad laptop
# ═══════════════════════════════════════════════════════════
gestures {
    workspace_swipe_distance = 250
    workspace_swipe_invert = true
    workspace_swipe_min_speed_to_force = 20
    workspace_swipe_cancel_ratio = 0.5
    workspace_swipe_create_new = true
    workspace_swipe_forever = true
    workspace_swipe_use_r = false
}

# ═══════════════════════════════════════════════════════════
# MISCELLANEOUS
# ═══════════════════════════════════════════════════════════
misc {
    disable_hyprland_logo = true
    disable_splash_rendering = true
    mouse_move_enables_dpms = true
    key_press_enables_dpms = true
    vrr = 1
    vfr = true
    enable_swallow = true
    swallow_regex = ^(konsole)$
    focus_on_activate = true
    new_window_takes_over_fullscreen = 2
    middle_click_paste = false
}

# ═══════════════════════════════════════════════════════════
# WINDOW RULES - KDE Plasma apps
# ═══════════════════════════════════════════════════════════

# Floating windows
windowrulev2 = float,class:^(org.kde.polkit-kde-authentication-agent-1)$
windowrulev2 = float,class:^(pavucontrol)$
windowrulev2 = float,class:^(nm-connection-editor)$
windowrulev2 = float,class:^(org.kde.kdeconnect)$
windowrulev2 = float,class:^(org.kde.dolphin)$,title:^(Copying)
windowrulev2 = float,class:^(org.kde.dolphin)$,title:^(Moving)
windowrulev2 = float,class:^(org.kde.dolphin)$,title:^(Deleting)
windowrulev2 = float,class:^(org.kde.kcalc)$
windowrulev2 = float,title:^(Picture-in-Picture)$
windowrulev2 = float,class:^(firefox)$,title:^(Picture-in-Picture)$
windowrulev2 = float,class:^(zenity)$
windowrulev2 = float,class:^(xdg-desktop-portal-gtk)$

# Size rules
windowrulev2 = size 800 600,class:^(pavucontrol)$
windowrulev2 = size 700 500,class:^(org.kde.kcalc)$
windowrulev2 = center,class:^(pavucontrol)$
windowrulev2 = center,class:^(org.kde.kcalc)$

# Opacity rules - leggera trasparenza
windowrulev2 = opacity 0.95 0.88,class:^(konsole)$
windowrulev2 = opacity 0.97 0.92,class:^(org.kde.dolphin)$
windowrulev2 = opacity 0.96 0.90,class:^(Code)$
windowrulev2 = opacity 1.0 1.0,class:^(firefox)$
windowrulev2 = opacity 1.0 1.0,class:^(chromium)$

# Picture in Picture
windowrulev2 = pin,title:^(Picture-in-Picture)$
windowrulev2 = keepaspectratio,title:^(Picture-in-Picture)$
windowrulev2 = size 25% 25%,title:^(Picture-in-Picture)$
windowrulev2 = move 74% 74%,title:^(Picture-in-Picture)$

# Workspace rules
windowrulev2 = workspace 1,class:^(firefox)$
windowrulev2 = workspace 2,class:^(Code)$
windowrulev2 = workspace 2,class:^(jetbrains)(.*)$
windowrulev2 = workspace 3,class:^(discord)$
windowrulev2 = workspace 3,class:^(Slack)$
windowrulev2 = workspace 4,class:^(Spotify)$
windowrulev2 = workspace 5,class:^(org.kde.dolphin)$

# Idle inhibit
windowrulev2 = idleinhibit focus,class:^(mpv)$
windowrulev2 = idleinhibit focus,class:^(vlc)$
windowrulev2 = idleinhibit fullscreen,class:^(firefox)$

# Tearing per gaming (se necessario)
windowrulev2 = immediate,class:^(steam_app)(.*)$

# ═══════════════════════════════════════════════════════════
# LAYER RULES
# ═══════════════════════════════════════════════════════════
layerrule = blur,waybar
layerrule = blur,wofi
layerrule = blur,notifications
layerrule = ignorezero,waybar
layerrule = ignorezero,wofi

# ═══════════════════════════════════════════════════════════
# KEYBINDINGS
# ═══════════════════════════════════════════════════════════
$mainMod = SUPER

# Applications - KDE focused
bind = $mainMod, RETURN, exec, konsole
bind = $mainMod, Q, killactive,
bind = $mainMod, M, exit,
bind = $mainMod, E, exec, dolphin
bind = $mainMod, F, togglefloating,
bind = $mainMod, D, exec, wofi --show drun
bind = $mainMod, R, exec, wofi --show run
bind = $mainMod, P, pseudo,
bind = $mainMod, J, togglesplit,
bind = $mainMod, V, exec, cliphist list | wofi -dmenu | cliphist decode | wl-copy
bind = $mainMod, L, exec, loginctl lock-session
bind = $mainMod SHIFT, S, exec, grimblast copy area
bind = $mainMod SHIFT, L, exec, swaylock -f
bind = $mainMod SHIFT, E, exec, systemsettings

# Power management per laptop
bind = $mainMod SHIFT, P, exec, systemctl suspend
bind = $mainMod CTRL, P, exec, systemctl poweroff

# Window management
bind = $mainMod, W, fullscreen, 0
bind = $mainMod SHIFT, F, fullscreen, 1
bind = $mainMod, C, centerwindow,
bind = $mainMod, B, exec, killall -SIGUSR1 waybar
bind = $mainMod, T, pin

# Focus movement
bind = $mainMod, left, movefocus, l
bind = $mainMod, right, movefocus, r
bind = $mainMod, up, movefocus, u
bind = $mainMod, down, movefocus, d

# Window movement
bind = $mainMod SHIFT, left, movewindow, l
bind = $mainMod SHIFT, right, movewindow, r
bind = $mainMod SHIFT, up, movewindow, u
bind = $mainMod SHIFT, down, movewindow, d

# Resize windows
binde = $mainMod CTRL, left, resizeactive, -60 0
binde = $mainMod CTRL, right, resizeactive, 60 0
binde = $mainMod CTRL, up, resizeactive, 0 -60
binde = $mainMod CTRL, down, resizeactive, 0 60

# Workspace switching
bind = $mainMod, 1, workspace, 1
bind = $mainMod, 2, workspace, 2
bind = $mainMod, 3, workspace, 3
bind = $mainMod, 4, workspace, 4
bind = $mainMod, 5, workspace, 5
bind = $mainMod, 6, workspace, 6
bind = $mainMod, 7, workspace, 7
bind = $mainMod, 8, workspace, 8
bind = $mainMod, 9, workspace, 9
bind = $mainMod, 0, workspace, 10

# Move window to workspace
bind = $mainMod SHIFT, 1, movetoworkspace, 1
bind = $mainMod SHIFT, 2, movetoworkspace, 2
bind = $mainMod SHIFT, 3, movetoworkspace, 3
bind = $mainMod SHIFT, 4, movetoworkspace, 4
bind = $mainMod SHIFT, 5, movetoworkspace, 5
bind = $mainMod SHIFT, 6, movetoworkspace, 6
bind = $mainMod SHIFT, 7, movetoworkspace, 7
bind = $mainMod SHIFT, 8, movetoworkspace, 8
bind = $mainMod SHIFT, 9, movetoworkspace, 9
bind = $mainMod SHIFT, 0, movetoworkspace, 10

# Special workspace (scratchpad)
bind = $mainMod, S, togglespecialworkspace, magic
bind = $mainMod SHIFT, S, movetoworkspace, special:magic

# Scroll through workspaces
bind = $mainMod, mouse_down, workspace, e+1
bind = $mainMod, mouse_up, workspace, e-1
bind = $mainMod, TAB, workspace, e+1
bind = $mainMod SHIFT, TAB, workspace, e-1

# Mouse bindings
bindm = $mainMod, mouse:272, movewindow
bindm = $mainMod, mouse:273, resizewindow

# Media keys - IdeaPad
bind = , XF86AudioRaiseVolume, exec, wpctl set-volume -l 1.5 @DEFAULT_AUDIO_SINK@ 5%+
bind = , XF86AudioLowerVolume, exec, wpctl set-volume @DEFAULT_AUDIO_SINK@ 5%-
bind = , XF86AudioMute, exec, wpctl set-mute @DEFAULT_AUDIO_SINK@ toggle
bind = , XF86AudioMicMute, exec, wpctl set-mute @DEFAULT_AUDIO_SOURCE@ toggle
bind = , XF86AudioPlay, exec, playerctl play-pause
bind = , XF86AudioPause, exec, playerctl play-pause
bind = , XF86AudioNext, exec, playerctl next
bind = , XF86AudioPrev, exec, playerctl previous

# Brightness control - importante per laptop
bind = , XF86MonBrightnessUp, exec, brightnessctl set 5%+
bind = , XF86MonBrightnessDown, exec, brightnessctl set 5%-

# Keyboard backlight (se presente)
bind = , XF86KbdBrightnessUp, exec, brightnessctl --device='*::kbd_backlight' set 33%+
bind = , XF86KbdBrightnessDown, exec, brightnessctl --device='*::kbd_backlight' set 33%-

# Display toggle (utile per presentazioni)
bind = , XF86Display, exec, wdisplays

# ═══════════════════════════════════════════════════════════
# SUBMAP - RESIZE MODE
# ═══════════════════════════════════════════════════════════
bind = $mainMod ALT, R, submap, resize
submap = resize
binde = , right, resizeactive, 60 0
binde = , left, resizeactive, -60 0
binde = , up, resizeactive, 0 -60
binde = , down, resizeactive, 0 60
bind = , escape, submap, reset
bind = , RETURN, submap, reset
submap = reset

# ═══════════════════════════════════════════════════════════
# LAPTOP POWER MANAGEMENT
# ═══════════════════════════════════════════════════════════

# Lid switch
bindl = , switch:on:Lid Switch, exec, systemctl suspend
bindl = , switch:off:Lid Switch, exec, hyprctl dispatch dpms on

# Battery warnings (attraverso script personalizzato)
# exec-once = ~/.config/hypr/scripts/battery-warning.sh

# ═══════════════════════════════════════════════════════════
# PERFORMANCE TUNING per AMD Ryzen 7 8845HS + Radeon 780M
# ═══════════════════════════════════════════════════════════

# VRR per refresh variabile (utile per risparmiare batteria)
# vrr = 1 è già attivo sopra

# Rendering ottimizzato
render {
    direct_scanout = true
}

# ═══════════════════════════════════════════════════════════
# DEBUG (decommenta se necessario)
# ═══════════════════════════════════════════════════════════
# debug {
#     disable_logs = false
#     enable_stdout_logs = true
# }
